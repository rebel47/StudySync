<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudySync Pro - Enhanced Collaborative Timer</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/responsive.css">
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">StudySync Pro</div>
                <div class="header-actions">
                    <div class="status-indicator">
                        <div class="status-dot" id="connectionStatus"></div>
                        <span id="participantCount">1 student</span>
                    </div>
                    <button class="btn" id="settingsBtn">‚öôÔ∏è</button>
                    <button class="btn" id="focusBtn">üéØ Focus</button>
                    <button class="chat-toggle-btn" id="chatToggleBtn" style="display:none;" title="Open Chat">
                        üí¨ Chat
                        <span class="chat-notification" id="chatNotification" style="display:none;">0</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main">
            <div class="grid">
                <!-- Timer Section -->
                <div class="timer-card">
                    <div class="mode-display" id="modeDisplay">Focus Session</div>
                    
                    <div class="timer-container">
                        <div class="timer-display" id="timerDisplay">25:00</div>
                        <svg class="timer-ring" viewBox="0 0 200 200">
                            <defs>
                                <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#3b82f6"/>
                                    <stop offset="100%" style="stop-color:#06b6d4"/>
                                </linearGradient>
                            </defs>
                            <circle cx="100" cy="100" r="90" 
                                stroke-dasharray="565.48" 
                                stroke-dashoffset="0" 
                                id="progressCircle">
                            </circle>
                        </svg>
                    </div>

                    <div class="controls">
                        <button class="btn primary" id="startBtn">Start</button>
                        <button class="btn" id="pauseBtn" style="display: none;">Pause</button>
                        <button class="btn" id="resetBtn">Reset</button>
                        <button class="btn" id="skipBtn">Skip</button>
                    </div>

                    <div class="mode-selector">
                        <div class="mode-btn active" data-mode="focus" data-duration="1500">Focus 25m</div>
                        <div class="mode-btn" data-mode="short-break" data-duration="300">Break 5m</div>
                        <div class="mode-btn" data-mode="long-focus" data-duration="3300">Focus 55m</div>
                        <div class="mode-btn" data-mode="custom" data-duration="3000">Custom </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div>
                    <!-- Session Stats -->
                    <div class="stats-card">
                        <div class="stats-header">
                            <h3 class="stats-title">Today's Progress</h3>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value" id="sessionsCompleted">0</div>
                                <div class="stat-label">Sessions</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="focusTime">0h</div>
                                <div class="stat-label">Focus Time</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="currentStreak">0</div>
                                <div class="stat-label">Streak</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="productivityScore">0%</div>
                                <div class="stat-label">Score</div>
                            </div>
                        </div>
                    </div>

                    <!-- Room Management -->
                    <div class="room-card">
                        <div class="room-header">
                            <h3 class="room-title">Study Room</h3>
                            <div class="room-code" id="roomCode">Solo</div>
                        </div>
                        
                        <div class="room-actions">
                            <button class="btn" id="createRoomBtn">Create Room</button>
                            <button class="btn" id="joinRoomBtn">Join Room</button>
                        </div>
                        
                        <div class="input-group" id="roomUrlGroup" style="display: none;">
                            <input type="text" class="input" id="roomUrl" readonly placeholder="Room URL will appear here">
                            <button class="btn" id="copyRoomBtn">üìã Copy</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Chat Sidebar -->
        <div class="chat-sidebar" id="chatSidebar">
            <div class="chat-sidebar-header">
                <h3 class="chat-sidebar-title">Study Chat</h3>
                <button class="chat-close-btn" id="chatCloseBtn">√ó</button>
            </div>
            
            <div class="chat-sidebar-messages" id="chatMessages">
                <div class="chat-welcome-message">
                    <div class="welcome-icon">üéØ</div>
                    <div class="welcome-text">Welcome to your study room!</div>
                    <div class="welcome-subtext">Chat with your study partners here</div>
                </div>
            </div>

            <div class="chat-sidebar-input">
                <input type="text" class="chat-sidebar-input-field" id="chatInput" placeholder="Type a message..." maxlength="200">
                <button class="chat-sidebar-send-btn" id="sendBtn">
                    <svg width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M15.854.146a.5.5 0 0 1 .11.54L13.026 8.03a.5.5 0 0 1-.708.132L8 6.707l-1.855.925a.5.5 0 0 1-.671-.133L1.146 3.146a.5.5 0 0 1 .708-.708L6 6.586l6.146-6.44a.5.5 0 0 1 .708 0z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Chat Overlay -->
        <div class="chat-overlay" id="chatOverlay"></div>

        <!-- Focus Mode Overlay -->
        <div class="focus-overlay" id="focusOverlay">
            <button class="focus-exit" id="focusExitBtn">Exit Focus</button>
            <div class="mode-display" id="focusModeDisplay">Focus Session</div>
            <div class="focus-timer" id="focusTimerDisplay">25:00</div>
            <div class="focus-controls">
                <button class="btn primary" id="focusStartBtn">Start</button>
                <button class="btn" id="focusResetBtn">Reset</button>
            </div>
        </div>

        <!-- Settings Panel -->
        <div class="settings-panel" id="settingsPanel">
            <div class="settings-header">
                <h3>Settings</h3>
                <button class="btn" id="closeSettingsBtn">‚úï</button>
            </div>
            <div class="settings-content">
                <div class="setting-group">
                    <label class="setting-label">Sound Notifications</label>
                    <div class="toggle">
                        <div class="toggle-switch active" id="soundToggle">
                            <div class="toggle-slider"></div>
                        </div>
                        <span>Play sound on completion</span>
                    </div>
                </div>
                
                <div class="setting-group">
                    <label class="setting-label">Auto-start Breaks</label>
                    <div class="toggle">
                        <div class="toggle-switch" id="autoBreakToggle">
                            <div class="toggle-slider"></div>
                        </div>
                        <span>Automatically start break timers</span>
                    </div>
                </div>
                
                <div class="setting-group">
                    <label class="setting-label">Desktop Notifications</label>
                    <div class="toggle">
                        <div class="toggle-switch" id="notificationToggle">
                            <div class="toggle-slider"></div>
                        </div>
                        <span>Show browser notifications</span>
                    </div>
                </div>

                <div class="setting-group">
                    <label class="setting-label">Custom Focus Duration (minutes)</label>
                    <input type="number" class="input" id="customDurationInput" min="1" max="120" value="25" placeholder="25">
                </div>

                <div class="setting-group">
                    <label class="setting-label">Your Name</label>
                    <input type="text" class="input" id="userNameInput" placeholder="Enter your name" maxlength="20">
                </div>
            </div>
        </div>

        <!-- Toast Notifications -->
        <div class="toast" id="toast"></div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <!-- Core Modules -->
    <script src="js/config/firebase.js"></script>
    <script src="js/modules/EventEmitter.js"></script>
    <script src="js/modules/TimerModule.js"></script>
    <script src="js/modules/FirebaseModule.js"></script>
    <script src="js/modules/StatsModule.js"></script>
    <script src="js/modules/SettingsModule.js"></script>
    <script src="js/modules/UIModule.js"></script>
    <script src="js/modules/AudioModule.js"></script>
    
    <!-- Main Application -->
    <script src="js/StudySyncApp.js"></script>
    <!-- App Initialization -->
    <script src="js/main.js"></script>
    
    <!-- Temporary Debug Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded - setting up chat');
            
            const chatToggleBtn = document.getElementById('chatToggleBtn');
            const chatSidebar = document.getElementById('chatSidebar');
            const chatOverlay = document.getElementById('chatOverlay');
            const chatCloseBtn = document.getElementById('chatCloseBtn');
            
            // Make sure chat button is visible
            if (chatToggleBtn) {
                chatToggleBtn.style.display = 'inline-flex';
                console.log('Chat button is visible');
                
                // Open chat when clicked
                chatToggleBtn.addEventListener('click', function() {
                    console.log('Opening chat...');
                    if (chatSidebar) {
                        chatSidebar.classList.add('open');
                        console.log('Added open class to sidebar');
                    }
                    if (chatOverlay) {
                        chatOverlay.classList.add('active');
                        console.log('Added active class to overlay');
                    }
                });
            }
            
            // Close chat when X is clicked
            if (chatCloseBtn) {
                chatCloseBtn.addEventListener('click', function() {
                    console.log('Closing chat...');
                    if (chatSidebar) {
                        chatSidebar.classList.remove('open');
                    }
                    if (chatOverlay) {
                        chatOverlay.classList.remove('active');
                    }
                });
            }
            
            // Close chat when overlay is clicked
            if (chatOverlay) {
                chatOverlay.addEventListener('click', function() {
                    console.log('Closing chat via overlay...');
                    if (chatSidebar) {
                        chatSidebar.classList.remove('open');
                    }
                    chatOverlay.classList.remove('active');
                });
            }
        });
    </script>
</body>
</html>